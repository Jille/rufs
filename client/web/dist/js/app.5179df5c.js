(function(t){function e(e){for(var a,n,i=e[0],c=e[1],l=e[2],u=0,d=[];u<i.length;u++)n=i[u],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&d.push(s[n][0]),s[n]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);h&&h(e);while(d.length)d.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],a=!0,i=1;i<r.length;i++){var c=r[i];0!==s[c]&&(a=!1)}a&&(o.splice(e--,1),t=n(n.s=r[0]))}return t}var a={},s={app:0},o=[];function n(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=a,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var h=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("cd49")},"06a3":function(t,e,r){"use strict";r("4000")},"245c":function(t,e,r){"use strict";r("ed8b")},4e3:function(t,e,r){},"5c0b":function(t,e,r){"use strict";r("c58b")},c58b:function(t,e,r){},cd49:function(t,e,r){"use strict";r.r(e);var a=r("2b0e"),s=r("5f5b"),o=r("b1e0"),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[t.error?r("Box",{attrs:{title:"Error"}},[t._v(" "+t._s(t.error)+" ")]):t.config?t.addingCircle?r("AddCircleWizard",{attrs:{version:t.version,config:t.config}}):r("Box",{attrs:{title:"You're all set up!"}},[t._v(" You can close this tab now. ")]):r("Box",{attrs:{title:"Loading..."}})],1)},i=[],c=r("9ab4"),l=r("1b40");class h{constructor(t,e){this.local=t,this.remote=e}}class u{constructor(t,e){this.name=t,this.shares=e}}class d{constructor(t){this.circles=t}}async function p(t){let e=t.statusText;try{const r=await t.json();r.error&&(e=r.error)}catch{}return e}class f{static async getVersion(){const t=await fetch("/api/version");if(!t.ok)throw new Error("Failed retrieving config: "+await p(t));const e=await t.json();return e.Version}static async getHostname(){const t=await fetch("/api/hostname");if(!t.ok)throw new Error("Failed retrieving config: "+await p(t));const e=await t.json();return e.Hostname}static async getConfig(){const t=await fetch("/api/config");if(!t.ok)throw new Error("Failed retrieving config: "+await p(t));const e=await t.json(),r=[];return null===e.Circles&&(e.Circles=[]),e.Circles.forEach(t=>{const e=[];null===t.Shares&&(t.Shares=[]),t.Shares.forEach(t=>{e.push(new h(t.Local,t.Remote))}),r.push(new u(t.Name,e))}),new d(r)}static async register(t,e,r,a){const s=await fetch("/api/register?"+new URLSearchParams({circle:t,user:e,token:r,ca:a}));if(!s.ok)throw new Error("Failed to add circle: "+await p(s))}static async sharesInCircle(t){const e=await fetch("/api/shares_in_circle?"+new URLSearchParams({circle:t}));if(!e.ok)throw new Error("Failed to retrieve shares in circle: "+await p(e));const r=await e.json();return null===r.Shares&&(r.Shares=[]),r.Shares}static async addShare(t,e,r){const a=await fetch("/api/add_share?"+new URLSearchParams({circle:t,share:e,local:r}));if(!a.ok)throw new Error("Failed to add share to circle: "+await p(a))}static async openExplorer(){const t=await fetch("/api/open_explorer");return t.ok}}var v=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"box"},[t.title?r("h1",[t._v(t._s(t.title))]):t._e(),r("div",{staticClass:"box-contents"},[t._t("default")],2)])},w=[];let g=class extends l["c"]{};Object(c["a"])([Object(l["b"])()],g.prototype,"title",void 0),g=Object(c["a"])([l["a"]],g);var m=g,b=m,y=(r("06a3"),r("2877")),_=Object(y["a"])(b,v,w,!1,null,"e061526c",null),C=_.exports,x=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[0==t.stage?r("Box",{attrs:{title:"Welcome to rufs."}},[r("p",[t._v("Let's get you set up with your first circle. Please enter the information you received from your circle admin below:")]),r("table",{staticClass:"table"},[r("tbody",[r("tr",[r("td",[t._v("Circle address")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.circle,expression:"circle"}],staticClass:"form-control",attrs:{type:"text",placeholder:"rufs.example.org"},domProps:{value:t.circle},on:{input:function(e){e.target.composing||(t.circle=e.target.value)}}})])]),r("tr",[r("td",[t._v("Username")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.user,expression:"user"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.user},on:{input:function(e){e.target.composing||(t.user=e.target.value)}}})])]),r("tr",[r("td",[t._v("Invite token")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.token,expression:"token"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.token},on:{input:function(e){e.target.composing||(t.token=e.target.value)}}})])]),r("tr",[r("td",[t._v("CA certificate")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.ca,expression:"ca"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.ca},on:{input:function(e){e.target.composing||(t.ca=e.target.value)}}})])])])]),r("div",[r("p",[t._v("Or use OIDC if your provider is listed here:")]),r("a",{attrs:{href:t.hashruIDM}},[r("img",{attrs:{src:"https://idm.hashru.nl/pkg/img/logo-square.svg",width:"60"}})])]),r("div",{staticClass:"buttons"},[r("p",[t._v("rufs "+t._s(t.version))]),r("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.canAddCircle()},on:{click:t.addCircle}},[t._v(" Connect to circle ")])])]):t._e(),1==t.stage?r("Box",{attrs:{title:"Adding circle..."}},[t.error?r("p",{staticClass:"error"},[t._v(t._s(t.error))]):r("center",[r("span",{staticClass:"icon-downloading"})])],1):t._e(),2==t.stage?r("Box",{attrs:{title:"Connected to circle!"}},[t.error?r("p",{staticClass:"error"},[t._v(t._s(t.error))]):t._e(),r("p",[t._v("If you want to share your own files with the circle, you can configure "),r("em",[t._v("shares")]),t._v(". Some shares may already exist, and you can expand them with files from a local directory you choose. You can also create a new share.")]),r("table",{staticClass:"table"},[r("thead",[r("tr",[r("th",{staticStyle:{width:"50%"}},[t._v("Share name in circle")]),r("th",{staticStyle:{width:"50%"}},[t._v("Local directory")])])]),r("tbody",[0==t.shares.length?r("tr",[r("td",{attrs:{colspan:"2"}},[t._v(" Nobody is sharing anything yet in this circle. Click the button below to share the first directory. ")])]):t._e(),t._l(t.shares,(function(e,a){return r("tr",{key:a},[r("td",[e.isNewShare?[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.share,expression:"share.share"}],class:{"form-control":!0,"is-invalid":!t.isValidShareName(e.share)},attrs:{type:"text",placeholder:"Enter a public name"},domProps:{value:e.share},on:{input:function(r){r.target.composing||t.$set(e,"share",r.target.value)}}}),r("button",{staticClass:"btn btn-outline-danger",attrs:{type:"button",tabindex:"-1"},on:{click:function(e){return t.shares.splice(a,1)}}},[t._v("-")])])]:[t._v(" "+t._s(e.share)+" ")]],2),r("td",[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.localPath,expression:"share.localPath"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Enter a local path to share it"},domProps:{value:e.localPath},on:{input:function(r){r.target.composing||t.$set(e,"localPath",r.target.value)}}})])])])}))],2),r("tfoot",[r("tr",[r("td",{attrs:{colspan:"2"}},[r("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:t.addNewShare}},[r("svg",{staticClass:"bi bi-plus",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[r("path",{attrs:{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}})]),t._v(" Add a share ")])])])])]),r("div",{staticClass:"buttons"},[r("p",[t._v("rufs "+t._s(t.version))]),r("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.canSaveShares},on:{click:t.saveShares}},[t._v(" "+t._s(t.anythingShared?"Save and continue":"Continue without sharing")+" ")])])]):t._e(),3==t.stage?r("Box",{attrs:{title:"Saving changes..."}},[t.error?r("p",{staticClass:"error"},[t._v(t._s(t.error))]):r("center",[r("span",{staticClass:"icon-downloading"})])],1):t._e(),4==t.stage?r("Box",{attrs:{title:"You're all done!"}},[r("p",[t._v("All files you share, and files shared with you, should now be visible in your rufs directory.")]),r("div",{staticClass:"buttons"},[r("p",[t._v("rufs "+t._s(t.version))]),t.closeFailed?t._e():r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.closeWindow}},[t._v(" Close ")]),t.closeFailed?r("p",{staticClass:"error"},[t._v(" Looks like that close button didn't work. Go ahead and close this tab yourself. ")]):t._e()])]):t._e()],1)},S=[];let k=class extends l["c"]{constructor(){super(...arguments),this.circle="",this.user="",this.token="",this.ca="",this.hostname="",this.stage=0,this.error="",this.shares=[],this.closeFailed=!1}async beforeMount(){const t=new URLSearchParams(window.location.search);this.circle=t.get("circle")||"",this.user=t.get("username")||"",this.token=t.get("token")||"",this.ca=t.get("fingerprint")||"",f.getHostname().then(t=>{this.hostname=t}).catch(()=>{})}canAddCircle(){return!!this.circle&&!!this.user&&!!this.token&&!!this.ca}isValidShareName(t){return new RegExp("^[a-zA-Z0-9 _.-]+$").test(t)}get anythingShared(){for(let t=0;t<this.shares.length;t+=1)if(""!=this.shares[t].localPath||this.shares[t].isNewShare)return!0;return!1}get canSaveShares(){for(let t=0;t<this.shares.length;t+=1)if(this.shares[t].isNewShare&&(""==this.shares[t].share||""==this.shares[t].localPath))return!1;return!0}async addCircle(){this.stage=1;try{await f.register(this.circle,this.user,this.token,this.ca);let t=await f.sharesInCircle(this.circle);this.shares=[],t.forEach(t=>{this.shares.push({share:t,localPath:"",isNewShare:!1})}),this.stage=2}catch(t){this.error=t.message}}addNewShare(){this.shares.push({share:"",localPath:"",isNewShare:!0})}async saveShares(){this.stage=3;try{for(var t=0;t<this.shares.length;++t){const e=this.shares[t];""!=e.localPath&&await f.addShare(this.circle,e.share,e.localPath)}await f.openExplorer(),this.stage=4}catch(e){this.error=e.message}}closeWindow(){window.close(),setTimeout(()=>{window.close()},500),setTimeout(()=>{window.close()},1e3),setTimeout(()=>{window.close()},1500),setTimeout(()=>{this.closeFailed=!0,window.close()},2e3)}get hashruIDM(){return"https://rufs.hashru.nl/?hostname="+encodeURIComponent(this.hostname)+"&return_url="+encodeURIComponent(location.href)}};Object(c["a"])([Object(l["b"])()],k.prototype,"version",void 0),Object(c["a"])([Object(l["b"])()],k.prototype,"config",void 0),k=Object(c["a"])([Object(l["a"])({components:{Box:C}})],k);var j=k,P=j,O=(r("245c"),Object(y["a"])(P,x,S,!1,null,null,null)),E=O.exports;let N=class extends l["c"]{constructor(){super(...arguments),this.version="",this.config=null,this.addingCircle=!1,this.error=""}async mounted(){try{this.version=await f.getVersion(),this.config=await f.getConfig(),this.addingCircle=!0}catch(t){this.error="error"in t?t.error:t.message}}};N=Object(c["a"])([Object(l["a"])({components:{Box:C,AddCircleWizard:E}})],N);var A=N,B=A,F=(r("5c0b"),Object(y["a"])(B,n,i,!1,null,null,null)),I=F.exports;r("f9e3"),r("2dd8");a["default"].use(s["a"]),a["default"].use(o["a"]);const L="Please report this bug, and include a description of what you were doing. If you can, please include a screenshot of the browser console.";a["default"].config.errorHandler=(t,e,r)=>{console.log("Unhandled Vue error: ",t,e,r),alert("An unhandled Vue error occurred. "+L)},window.onerror=(t,e,r,a,s)=>{console.log("Unhandled window error event: ",t,e,r,a,s),alert("An unhandled window error occurred. "+L)},window.addEventListener("unhandledrejection",t=>{console.log("Unhandled rejection error: ",t),alert("An unhandled promise rejection occurred. "+L)}),a["default"].config.productionTip=!1,new a["default"]({render:t=>t(I)}).$mount("#app")},ed8b:function(t,e,r){}});
//# sourceMappingURL=app.5179df5c.js.map