(function(e){function t(t){for(var a,i,n=t[0],c=t[1],l=t[2],u=0,d=[];u<n.length;u++)i=n[u],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&d.push(s[i][0]),s[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);h&&h(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,n=1;n<r.length;n++){var c=r[n];0!==s[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var a={},s={app:0},o=[];function i(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=a,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],c=n.push.bind(n);n.push=t,n=n.slice();for(var l=0;l<n.length;l++)t(n[l]);var h=c;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"06a3":function(e,t,r){"use strict";r("4000")},"245c":function(e,t,r){"use strict";r("ed8b")},4e3:function(e,t,r){},"5c0b":function(e,t,r){"use strict";r("c58b")},c58b:function(e,t,r){},cd49:function(e,t,r){"use strict";r.r(t);var a=r("2b0e"),s=r("5f5b"),o=r("b1e0"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.error?r("Box",{attrs:{title:"Error"}},[e._v(" "+e._s(e.error)+" ")]):e.config?e.addingCircle?r("AddCircleWizard",{attrs:{version:e.version,config:e.config}}):r("Box",{attrs:{title:"You're all set up!"}},[e._v(" You can close this tab now. ")]):r("Box",{attrs:{title:"Loading..."}})],1)},n=[],c=r("9ab4"),l=r("1b40");class h{constructor(e,t){this.local=e,this.remote=t}}class u{constructor(e,t){this.name=e,this.shares=t}}class d{constructor(e){this.circles=e}}async function p(e){let t=e.statusText;try{const r=await e.json();r.error&&(t=r.error)}catch{}return t}class f{static async getVersion(){const e=await fetch("/api/version");if(!e.ok)throw new Error("Failed retrieving config: "+await p(e));const t=await e.json();return t.Version}static async getConfig(){const e=await fetch("/api/config");if(!e.ok)throw new Error("Failed retrieving config: "+await p(e));const t=await e.json(),r=[];return null===t.Circles&&(t.Circles=[]),t.Circles.forEach(e=>{const t=[];null===e.Shares&&(e.Shares=[]),e.Shares.forEach(e=>{t.push(new h(e.Local,e.Remote))}),r.push(new u(e.Name,t))}),new d(r)}static async register(e,t,r,a){const s=await fetch("/api/register?"+new URLSearchParams({circle:e,user:t,token:r,ca:a}));if(!s.ok)throw new Error("Failed to add circle: "+await p(s))}static async sharesInCircle(e){const t=await fetch("/api/shares_in_circle?"+new URLSearchParams({circle:e}));if(!t.ok)throw new Error("Failed to retrieve shares in circle: "+await p(t));const r=await t.json();return null===r.Shares&&(r.Shares=[]),r.Shares}static async addShare(e,t,r){const a=await fetch("/api/add_share?"+new URLSearchParams({circle:e,share:t,local:r}));if(!a.ok)throw new Error("Failed to add share to circle: "+await p(a))}static async openExplorer(){const e=await fetch("/api/open_explorer");return e.ok}}var v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box"},[e.title?r("h1",[e._v(e._s(e.title))]):e._e(),r("div",{staticClass:"box-contents"},[e._t("default")],2)])},w=[];let g=class extends l["c"]{};Object(c["a"])([Object(l["b"])()],g.prototype,"title",void 0),g=Object(c["a"])([l["a"]],g);var b=g,m=b,y=(r("06a3"),r("2877")),_=Object(y["a"])(m,v,w,!1,null,"e061526c",null),C=_.exports,x=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[0==e.stage?r("Box",{attrs:{title:"Welcome to rufs."}},[r("p",[e._v("Let's get you set up with your first circle. Please enter the information you received from your circle admin below:")]),r("table",{staticClass:"table"},[r("tbody",[r("tr",[r("td",[e._v("Circle address")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.circle,expression:"circle"}],staticClass:"form-control",attrs:{type:"text",placeholder:"rufs.example.org"},domProps:{value:e.circle},on:{input:function(t){t.target.composing||(e.circle=t.target.value)}}})])]),r("tr",[r("td",[e._v("Username")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}})])]),r("tr",[r("td",[e._v("Invite token")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.token,expression:"token"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.token},on:{input:function(t){t.target.composing||(e.token=t.target.value)}}})])]),r("tr",[r("td",[e._v("CA certificate")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ca,expression:"ca"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.ca},on:{input:function(t){t.target.composing||(e.ca=t.target.value)}}})])])])]),r("div",{staticClass:"buttons"},[r("p",[e._v("rufs "+e._s(e.version))]),r("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!e.canAddCircle()},on:{click:e.addCircle}},[e._v(" Connect to circle ")])])]):e._e(),1==e.stage?r("Box",{attrs:{title:"Adding circle..."}},[e.error?r("p",{staticClass:"error"},[e._v(e._s(e.error))]):r("center",[r("span",{staticClass:"icon-downloading"})])],1):e._e(),2==e.stage?r("Box",{attrs:{title:"Connected to circle!"}},[e.error?r("p",{staticClass:"error"},[e._v(e._s(e.error))]):e._e(),r("p",[e._v("If you want to share your own files with the circle, you can configure "),r("em",[e._v("shares")]),e._v(". Some shares may already exist, and you can expand them with files from a local directory you choose. You can also create a new share.")]),r("table",{staticClass:"table"},[r("thead",[r("tr",[r("th",{staticStyle:{width:"50%"}},[e._v("Share name in circle")]),r("th",{staticStyle:{width:"50%"}},[e._v("Local directory")])])]),r("tbody",[0==e.shares.length?r("tr",[r("td",{attrs:{colspan:"2"}},[e._v(" Nobody is sharing anything yet in this circle. Click the button below to share the first directory. ")])]):e._e(),e._l(e.shares,(function(t,a){return r("tr",{key:a},[r("td",[t.isNewShare?[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.share,expression:"share.share"}],class:{"form-control":!0,"is-invalid":!e.isValidShareName(t.share)},attrs:{type:"text",placeholder:"Enter a public name"},domProps:{value:t.share},on:{input:function(r){r.target.composing||e.$set(t,"share",r.target.value)}}}),r("button",{staticClass:"btn btn-outline-danger",attrs:{type:"button",tabindex:"-1"},on:{click:function(t){return e.shares.splice(a,1)}}},[e._v("-")])])]:[e._v(" "+e._s(t.share)+" ")]],2),r("td",[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.localPath,expression:"share.localPath"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Enter a local path to share it"},domProps:{value:t.localPath},on:{input:function(r){r.target.composing||e.$set(t,"localPath",r.target.value)}}})])])])}))],2),r("tfoot",[r("tr",[r("td",{attrs:{colspan:"2"}},[r("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:e.addNewShare}},[r("svg",{staticClass:"bi bi-plus",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[r("path",{attrs:{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}})]),e._v(" Add a share ")])])])])]),r("div",{staticClass:"buttons"},[r("p",[e._v("rufs "+e._s(e.version))]),r("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!e.canSaveShares},on:{click:e.saveShares}},[e._v(" "+e._s(e.anythingShared?"Save and continue":"Continue without sharing")+" ")])])]):e._e(),3==e.stage?r("Box",{attrs:{title:"Saving changes..."}},[e.error?r("p",{staticClass:"error"},[e._v(e._s(e.error))]):r("center",[r("span",{staticClass:"icon-downloading"})])],1):e._e(),4==e.stage?r("Box",{attrs:{title:"You're all done!"}},[r("p",[e._v("All files you share, and files shared with you, should now be visible in your rufs directory.")]),r("div",{staticClass:"buttons"},[r("p",[e._v("rufs "+e._s(e.version))]),e.closeFailed?e._e():r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.closeWindow}},[e._v(" Close ")]),e.closeFailed?r("p",{staticClass:"error"},[e._v(" Looks like that close button didn't work. Go ahead and close this tab yourself. ")]):e._e()])]):e._e()],1)},S=[];let j=class extends l["c"]{constructor(){super(...arguments),this.circle="",this.user="",this.token="",this.ca="",this.stage=0,this.error="",this.shares=[],this.closeFailed=!1}canAddCircle(){return!!this.circle&&!!this.user&&!!this.token&&!!this.ca}isValidShareName(e){return new RegExp("^[a-zA-Z0-9 _.-]+$").test(e)}get anythingShared(){for(let e=0;e<this.shares.length;e+=1)if(""!=this.shares[e].localPath||this.shares[e].isNewShare)return!0;return!1}get canSaveShares(){for(let e=0;e<this.shares.length;e+=1)if(this.shares[e].isNewShare&&(""==this.shares[e].share||""==this.shares[e].localPath))return!1;return!0}async addCircle(){this.stage=1;try{await f.register(this.circle,this.user,this.token,this.ca);let e=await f.sharesInCircle(this.circle);this.shares=[],e.forEach(e=>{this.shares.push({share:e,localPath:"",isNewShare:!1})}),this.stage=2}catch(e){this.error=e.message}}addNewShare(){this.shares.push({share:"",localPath:"",isNewShare:!0})}async saveShares(){this.stage=3;try{for(var e=0;e<this.shares.length;++e){const t=this.shares[e];""!=t.localPath&&await f.addShare(this.circle,t.share,t.localPath)}await f.openExplorer(),this.stage=4}catch(t){this.error=t.message}}closeWindow(){window.close(),setTimeout(()=>{window.close()},500),setTimeout(()=>{window.close()},1e3),setTimeout(()=>{window.close()},1500),setTimeout(()=>{this.closeFailed=!0,window.close()},2e3)}};Object(c["a"])([Object(l["b"])()],j.prototype,"version",void 0),Object(c["a"])([Object(l["b"])()],j.prototype,"config",void 0),j=Object(c["a"])([Object(l["a"])({components:{Box:C}})],j);var k=j,P=k,O=(r("245c"),Object(y["a"])(P,x,S,!1,null,null,null)),E=O.exports;let N=class extends l["c"]{constructor(){super(...arguments),this.version="",this.config=null,this.addingCircle=!1,this.error=""}async mounted(){try{this.version=await f.getVersion(),this.config=await f.getConfig(),this.addingCircle=!0}catch(e){this.error="error"in e?e.error:e.message}}};N=Object(c["a"])([Object(l["a"])({components:{Box:C,AddCircleWizard:E}})],N);var A=N,B=A,F=(r("5c0b"),Object(y["a"])(B,i,n,!1,null,null,null)),L=F.exports;r("f9e3"),r("2dd8");a["default"].use(s["a"]),a["default"].use(o["a"]);const T="Please report this bug, and include a description of what you were doing. If you can, please include a screenshot of the browser console.";a["default"].config.errorHandler=(e,t,r)=>{console.log("Unhandled Vue error: ",e,t,r),alert("An unhandled Vue error occurred. "+T)},window.onerror=(e,t,r,a,s)=>{console.log("Unhandled window error event: ",e,t,r,a,s),alert("An unhandled window error occurred. "+T)},window.addEventListener("unhandledrejection",e=>{console.log("Unhandled rejection error: ",e),alert("An unhandled promise rejection occurred. "+T)}),a["default"].config.productionTip=!1,new a["default"]({render:e=>e(L)}).$mount("#app")},ed8b:function(e,t,r){}});
//# sourceMappingURL=app.1e8bf834.js.map